<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Åø„Çì„Å™„Åß „Åª„Åó„Åû„Çâ„Ç∏„É£„É≥„Éó</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            touch-action: none;
            overflow: hidden;
            background: #0f172a;
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', sans-serif;
            user-select: none;
        }
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle 2s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
        #rocket {
            position: absolute;
            font-size: 3.5rem;
            z-index: 20;
            transition: transform 0.1s;
        }
        .wall {
            position: absolute;
            background: linear-gradient(to bottom, #4f46e5, #3730a3);
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.4);
        }
        .item {
            position: absolute;
            font-size: 2rem;
            z-index: 15;
        }
        .btn-fancy {
            background: #fbbf24;
            color: #1e1b4b;
            font-weight: 900;
            border-radius: 9999px;
            box-shadow: 0 4px 0 #b45309;
            transition: all 0.1s;
        }
        .btn-fancy:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #6366f1;
            color: white;
            padding: 12px;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 12px;
            font-size: 1.2rem;
            outline: none;
        }
        .rank-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 15px 25px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 320px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="m-0 p-0">

    <div id="game-container">
        <div id="stars-layer"></div>

        <!-- 1. Select Number of Players -->
        <div id="mode-screen" class="absolute inset-0 flex flex-col items-center justify-center z-50 bg-slate-900 p-6 text-center">
            <h1 class="text-4xl font-black text-yellow-400 mb-2">„Åª„Åó„Åû„Çâ„Ç∏„É£„É≥„Éó</h1>
            <p class="text-white text-xl mb-8">„Å™„Çì„Å´„Çì„Åß „ÅÇ„Åù„Å∂Ôºü</p>
            <div class="grid grid-cols-2 gap-4 w-full max-w-xs">
                <button onclick="selectPlayerCount(1)" class="btn-fancy py-6 text-3xl">1„Å´„Çì</button>
                <button onclick="selectPlayerCount(2)" class="btn-fancy py-6 text-3xl">2„Å´„Çì</button>
                <button onclick="selectPlayerCount(3)" class="btn-fancy py-6 text-3xl">3„Å´„Çì</button>
                <button onclick="selectPlayerCount(4)" class="btn-fancy py-6 text-3xl">4„Å´„Çì</button>
            </div>
        </div>

        <!-- 2. Name Entry Screen -->
        <div id="name-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center z-50 bg-slate-900 p-6 text-center overflow-y-auto">
            <h2 class="text-3xl font-black text-yellow-400 mb-6">„Å™„Åæ„Åà„Çí „ÅÑ„Çå„Å¶„Å≠</h2>
            <div id="name-inputs" class="w-full max-w-xs mb-8">
                <!-- Dynamic Inputs -->
            </div>
            <button id="confirm-names-btn" class="btn-fancy py-4 px-12 text-2xl">„Åç„Åæ„ÇäÔºÅ</button>
        </div>

        <!-- 3. Ready Screen -->
        <div id="ready-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center z-50 bg-indigo-900/90 p-6 text-center">
            <h2 id="turn-title" class="text-4xl font-black text-white mb-4">„Å™„Åæ„Åà „ÅÆ „Å∞„Çì</h2>
            <p class="text-indigo-200 text-xl mb-12">„Åò„ÇÖ„Çì„Å≥„ÅØ „ÅÑ„ÅÑ„Åã„Å™Ôºü</p>
            <button id="start-btn" class="btn-fancy py-8 px-20 text-4xl">„Çπ„Çø„Éº„ÉàÔºÅ</button>
        </div>

        <!-- 4. Game UI -->
        <div id="game-ui" class="hidden absolute top-0 left-0 w-full p-4 flex justify-between items-start z-40 pointer-events-none">
            <div class="bg-indigo-900/80 rounded-2xl p-3 border-2 border-indigo-400">
                <p id="current-player-display" class="text-xs text-indigo-300 font-bold">„Å™„Åæ„Åà</p>
                <p id="score-display" class="text-3xl font-black text-white">0m</p>
            </div>
        </div>

        <!-- Rocket -->
        <div id="rocket" class="hidden">üöÄ</div>

        <!-- 5. Turn Result Screen -->
        <div id="turn-result-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center z-50 bg-slate-900/95 p-6 text-center">
            <h2 class="text-4xl font-black text-red-400 mb-4">„Éâ„Ç´„Éº„É≥ÔºÅ</h2>
            <div id="player-score-msg" class="text-white text-2xl mb-12">„Å™„Åæ„Åà „ÅØ 100m „Åô„Åô„Çì„Å†ÔºÅ</div>
            <button id="next-player-btn" class="btn-fancy py-5 px-12 text-2xl">„Å§„Åé„Å∏ „Åô„Åô„ÇÄ</button>
        </div>

        <!-- 6. Final Leaderboard -->
        <div id="final-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center z-50 bg-slate-900 p-6 text-center">
            <h1 class="text-4xl font-black text-yellow-400 mb-8">üéâ „Åë„Å£„Åã„ÅØ„Å£„Å¥„Çá„ÅÜ</h1>
            <div id="ranking-list" class="flex flex-col items-center w-full mb-10"></div>
            <button id="restart-btn" class="bg-indigo-600 text-white font-black py-4 px-10 rounded-full text-xl shadow-lg active:scale-95">
                „Åï„ÅÑ„Åó„Çá„Å´ „ÇÇ„Å©„Çã
            </button>
        </div>
    </div>

    <script>
        const container = document.getElementById('game-container');
        const rocket = document.getElementById('rocket');
        const modeScreen = document.getElementById('mode-screen');
        const nameScreen = document.getElementById('name-screen');
        const readyScreen = document.getElementById('ready-screen');
        const turnResultScreen = document.getElementById('turn-result-screen');
        const finalScreen = document.getElementById('final-screen');
        const gameUI = document.getElementById('game-ui');
        
        let playerCount = 1;
        let players = [];
        let currentPlayerIndex = 0;
        let gameActive = false;
        let score = 0;
        
        // Physics
        let rocketY = 0;
        let velocity = 0;
        const gravity = 0.28;
        const jumpStrength = -6.5;
        const rocketX = 80;
        
        // Obstacles
        let walls = [];
        let items = [];
        let lastWallTime = 0;
        const wallGap = 230;
        const wallSpawnInterval = 1500;

        function initStars() {
            const starsLayer = document.getElementById('stars-layer');
            for (let i = 0; i < 40; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = size + 'px'; star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%'; star.style.top = Math.random() * 100 + '%';
                starsLayer.appendChild(star);
            }
        }

        // 1. Select Player Count
        function selectPlayerCount(count) {
            playerCount = count;
            modeScreen.classList.add('hidden');
            nameScreen.classList.remove('hidden');
            
            const nameInputs = document.getElementById('name-inputs');
            nameInputs.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'input-field';
                input.placeholder = `${i}„Å´„Çì„ÇÅ„ÅÆ „Å™„Åæ„Åà`;
                input.value = `„Éó„É¨„Ç§„É§„Éº${i}`;
                input.id = `p${i}-name`;
                nameInputs.appendChild(input);
            }
        }

        // 2. Confirm Names
        document.getElementById('confirm-names-btn').onclick = () => {
            players = [];
            for (let i = 1; i <= playerCount; i++) {
                const name = document.getElementById(`p${i}-name`).value || `${i}„Å´„Çì„ÇÅ`;
                players.push({ name: name, score: 0 });
            }
            currentPlayerIndex = 0;
            nameScreen.classList.add('hidden');
            showReadyScreen();
        };

        function showReadyScreen() {
            turnResultScreen.classList.add('hidden');
            readyScreen.classList.remove('hidden');
            document.getElementById('turn-title').textContent = `${players[currentPlayerIndex].name} „ÅÆ „Å∞„Çì`;
        }

        // 3. Start Game
        document.getElementById('start-btn').onclick = () => {
            readyScreen.classList.add('hidden');
            gameUI.classList.remove('hidden');
            rocket.classList.remove('hidden');
            document.getElementById('current-player-display').textContent = players[currentPlayerIndex].name;
            
            score = 0;
            rocketY = window.innerHeight / 2;
            velocity = 0;
            walls.forEach(w => w.el.remove());
            items.forEach(it => it.el.remove());
            walls = []; items = [];
            lastWallTime = Date.now();
            gameActive = true;
            update();
        };

        function update() {
            if (!gameActive) return;

            velocity += gravity;
            rocketY += velocity;
            rocket.style.top = rocketY + 'px';
            rocket.style.left = rocketX + 'px';
            
            const rotation = Math.min(Math.max(velocity * 4, -25), 45);
            rocket.style.transform = `rotate(${rotation}deg)`;

            if (rocketY < -50 || rocketY > window.innerHeight) gameOver();

            const speed = 4;
            for (let i = walls.length - 1; i >= 0; i--) {
                const wall = walls[i];
                wall.x -= speed;
                wall.el.style.left = wall.x + 'px';
                const r = rocket.getBoundingClientRect();
                const w = wall.el.getBoundingClientRect();
                if (r.right-20 > w.left && r.left+20 < w.right && r.bottom-20 > w.top && r.top+20 < w.bottom) gameOver();
                if (wall.x < -100) { wall.el.remove(); walls.splice(i, 1); }
            }

            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.x -= speed;
                item.el.style.left = item.x + 'px';
                const r = rocket.getBoundingClientRect();
                const it = item.el.getBoundingClientRect();
                if (r.right > it.left && r.left < it.right && r.bottom > it.top && r.top < it.bottom) {
                    score += 300; // Bonus for stars
                    item.el.remove(); items.splice(i, 1);
                }
                if (item.x < -100) { item.el.remove(); items.splice(i, 1); }
            }

            score += 2;
            document.getElementById('score-display').textContent = Math.floor(score / 10) + 'm';

            if (Date.now() - lastWallTime > wallSpawnInterval) {
                createWall();
                lastWallTime = Date.now();
            }
            requestAnimationFrame(update);
        }

        function createWall() {
            const h = 80 + Math.random() * (window.innerHeight - wallGap - 160);
            const w1 = document.createElement('div');
            w1.className = 'wall'; w1.style.width = '65px'; w1.style.height = h + 'px';
            w1.style.left = window.innerWidth + 'px'; w1.style.top = '0';
            container.appendChild(w1);
            walls.push({ el: w1, x: window.innerWidth });

            const w2 = document.createElement('div');
            w2.className = 'wall'; w2.style.width = '65px'; w2.style.height = (window.innerHeight - h - wallGap) + 'px';
            w2.style.left = window.innerWidth + 'px'; w2.style.bottom = '0';
            container.appendChild(w2);
            walls.push({ el: w2, x: window.innerWidth });

            if (Math.random() > 0.5) {
                const item = document.createElement('div');
                item.className = 'item'; item.textContent = '‚≠ê';
                item.style.left = (window.innerWidth + 15) + 'px';
                item.style.top = (h + wallGap/2 - 20) + 'px';
                container.appendChild(item);
                items.push({ el: item, x: window.innerWidth + 15 });
            }
        }

        function gameOver() {
            gameActive = false;
            rocket.classList.add('hidden');
            gameUI.classList.add('hidden');
            
            const finalScore = Math.floor(score / 10);
            players[currentPlayerIndex].score = finalScore;
            
            turnResultScreen.classList.remove('hidden');
            document.getElementById('player-score-msg').textContent = `${players[currentPlayerIndex].name} „ÅØ ${finalScore}m „Åô„Åô„Çì„Å†ÔºÅ`;
        }

        document.getElementById('next-player-btn').onclick = () => {
            currentPlayerIndex++;
            if (currentPlayerIndex < playerCount) {
                showReadyScreen();
            } else {
                showFinalRanking();
            }
        };

        function showFinalRanking() {
            turnResultScreen.classList.add('hidden');
            finalScreen.classList.remove('hidden');
            
            const sorted = [...players].sort((a, b) => b.score - a.score);
            const list = document.getElementById('ranking-list');
            list.innerHTML = '';
            
            const medals = ['ü•á', 'ü•à', 'ü•â', '‚ú®'];
            sorted.forEach((p, i) => {
                const row = document.createElement('div');
                row.className = 'rank-card';
                row.innerHTML = `
                    <span class="text-xl font-bold text-white">${medals[i] || '‚ú®'} ${p.name}</span>
                    <span class="text-xl font-black text-yellow-400">${p.score}m</span>
                `;
                list.appendChild(row);
            });
        }

        document.getElementById('restart-btn').onclick = () => {
            finalScreen.classList.add('hidden');
            modeScreen.classList.remove('hidden');
        };

        // Inputs
        const jumpAction = (e) => {
            if (gameActive && e.target.tagName !== 'BUTTON') {
                e.preventDefault();
                velocity = jumpStrength;
            }
        };
        window.addEventListener('mousedown', jumpAction);
        window.addEventListener('touchstart', jumpAction, { passive: false });

        initStars();
    </script>
</body>
</html>